---
title: "Histórico dos prefeitos atuais"
output: 
  html_document:
    fig_height: 7
    theme: paper
    toc: true
    toc_depth: 2
    toc_float:
      collapsed: false
      smooth_scroll: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

```{r}
library(dplyr)
library(plotly)
options(scipen = 999)
```

```{r}
source("load_historico.R")
```

# Aumento do patrimônio dos atuais prefeitos de 2012 para 2016
```{r}
top_prefeitos_ganho <- historico_bens_prefeitos_atuais %>% 
  mutate(ganho = totalBens2016 - totalBens2012) %>% 
  select(cpfCandidato, nomeCandidato, `2012` = totalBens2012, `2016` = totalBens2016, ganho, nomeUrnaCandidato, descUnidEleitoral) %>% 
  tidyr::gather("ano", "totalBens", 3:4) %>%
  arrange(desc(ganho))
```

```{r}
top_prefeitos_cargo <- historico_bens_prefeitos_atuais %>% 
  select(cpfCandidato, `2012` = descCargo2012, `2016` = descCargo) %>% 
  mutate(`2012` = if_else(is.na(`2012`), "Nada", `2012`)) %>% 
  mutate(`2016` = if_else(is.na(`2016`), "Nada", `2016`)) %>% 
  tidyr::gather("ano", "cargo", 2:3)
```

```{r}
top_prefeitos_situacao <- historico_bens_prefeitos_atuais %>% 
  select(cpfCandidato, `2012` = descSituacaoEleito2012, `2016` = descSituacaoEleito) %>% 
  mutate(`2012` = if_else(is.na(`2012`), "Nada", `2012`)) %>% 
  mutate(`2016` = if_else(is.na(`2016`), "Nada", `2016`)) %>% 
  tidyr::gather("ano", "situacaoEleito", 2:3)
```

```{r}
top_prefeitos <- top_prefeitos_ganho %>% 
  left_join(top_prefeitos_cargo) %>% 
  left_join(top_prefeitos_situacao)

rm(top_prefeitos_ganho, top_prefeitos_cargo, top_prefeitos_situacao)
```

## Top 10 prefeitos que mais aumentaram seu patrimônio
```{r}
top_prefeitos %>% 
  head(20) %>% 
  plot_ly() %>%
    add_trace(x = ~as.factor(ano), y = ~totalBens, color = ~nomeUrnaCandidato,
              type = "scatter", mode = "lines+markers",
              text = ~paste(
              "Prefeito:", nomeCandidato, "<br>",
              "Nome de urna:", nomeUrnaCandidato, "<br>",
              "Total de bens: R$ ", totalBens, "<br>",
              "Ganho (2016 - 2012): ", ganho, "<br>",
              "Cargo: ", cargo, "<br>",
              "Situação: ", situacaoEleito, "<br>",
              "Município:", descUnidEleitoral
              ),
            hoverinfo = "text") %>%
    layout(xaxis = list(title = ""),
                    legend = list(orientation = "h"),
           yaxis = list(title = "Valor declarado (R$)"))
```


